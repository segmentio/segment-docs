{% assign activeState = false %}
{% assign currentSlug = page.url | split: "/" | last %}
{% assign currentIntegration = site.data.catalogV2.sources.items | where: "slug", currentSlug | first %}

<div class="sidebar sidebar--dark">
  <nav class="menu">
    <ul class="menu__list list list--unstyle">
      <li class="menu-item menu-item--separated">
        <a href="{{ site.baseurl }}/connections/sources/catalog/" class="menu-item__link menu-item__link--small menu-item__link--highlight menu-item__link--icon flex flex--middle">
          <div class="menu-item__icon flex__column">
            {% include icons/menu/icon-back.svg %}
          </div>

          <div class="flex__column">Back to Connections</div>
        </a>
      </li>
    </ul>
  </nav>

  <nav class="menu menu--compact">
    <ul class="menu__list list list--unstyle">
      {% assign categories = site.data.catalogV2.destination_categories.items %}

      {% for category in categories %}
        {% assign integrations = site.data.catalogV2.sources.items | where: "categories", category.display_name %}

        <li class="menu-item menu-item--gray menu-item--compact {% if currentIntegration.categories contains category.display_name and activeState != true %}{% assign activeState = true %}menu-item--active{% endif %}" data-accordion data-class-active="menu-item--active">
          <button class="menu-item__link flex flex--middle flex--justify" data-ref="accordion[trigger]">
            <span class="flex__column">
              {{ category.display_name }}
            </span>

            <div class="menu-item__chevron flex__column flex__column--shrink">
              {% include icons/symbols/chevron-down.svg %}
            </div>
          </button>

          <ul class="menu-item__body" data-ref="accordion[body]">
            {% for integration in integrations %}
              <li class="menu-item menu-item--compact {% if integration == currentIntegration %}menu-item--active menu-item--indicator{% endif %}">
                <a href="{{ site.baseurl }}/{{ integration.url }}/" class="menu-item__link {% if integration == currentIntegration %}menu-item__link--indicator{% endif %}">
                  {{ integration.display_name }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ul>
  </nav>
</div>
